# gulpボイラープレート

## 必要要件

### Node.js

https://nodejs.org/ja/download/

制作時点でLTS（安定版）最新の`ver 10.15.0`を前提としています。
古いバージョンを使用している場合使用するパッケージによっては不具合が出る可能性があるため、特別な理由がなければ上記バージョンを使用してください。

## インストールまで

インストール作業はコマンドラインベースで行います。

Windowsは「コマンドプロンプト」または「PowerShell」を使用します。
MacOSは「ターミナル」を使用します。

### Node.jsが動作するかの確認

コマンドで`node -v`を打ち、`v10.15.0`と返ってくればOKです。

### ディレクトリに移動する

`cd （移動したいディレクトリのパス）`

### 必要パッケージのインストール

`npm install`

### コンフィグ

`src/config.js.sample` -> `src/config.js`にリネーム（.gitignoreされてます）

## タスク

### server

* サーバの起動

ローカルに開発用のサーバを立て、ソースに変更があった場合はその内容を自動で反映するよう監視します。デフォルトで3000番のポートを使用しますが、埋まっていた場合は自動で空いているポートを探して使用します。

起動している端末以外は、ポート番号を付与すれば同一LAN上から確認可能です。

* ゴーストモード

デフォルトではゴーストモードを切ってあります。ゴーストモードを使用すると、ソースの変化等だけではなく操作内容も同期します。

* startPath

起動時に開くページを指定出来ます。

### ejs

* EJSファイルをhtmlにコンパイルします。

ejsファイルの構文エラーでコンパイルが失敗した場合、出力ディレクトリにejsファイルがそのまま生成されてしまいます。後述の`npm run clean`スクリプトで、時々不要なゴミファイルを掃除するようにしてください。

### scss

* scssファイルをcssファイルにコンパイルします。

現状以下の処理が組み込まれています。

|パッケージ|処理内容|補足|
|:---|:---|:---|
|postcss-autoprefixer|ベンダープリフィックスを付与する||
|postcss-css-mq-packer|メディアクエリ記述を一箇所にまとめる||
|postcss-flex-bugs-fixes|flexbox関連のバグを修正する||
|gulp-clean-css|CSSファイルのミニファイ処理（圧縮）|`production`モードのみ有効|
|gulp-sass-glob|scssのimport時にワイルドカードを使えるようにする||

以下は組み込んではありますが、諸事情により使用していません。

|パッケージ|処理内容|停止理由|
|:---|:---|:---|
|csscomb|CSSファイルをルールに基づいて整形|sourcemapsに対応していないため|

### js

トランスパイルをして出力します。

変換対象がなかった場合は何も処理しないため、通常通り記述して構いません。一方で万が一余計な処理が行われて不具合を招くのを避けるため、jqueryなどのライブラリやプラグインはこのフォルダに含めず、`/src/assets`以下に配置するようにしてください。

|パッケージ|処理内容|補足|
|:---|:---|:---|
|gulp-babel|ES6記述のトランスパイル||
|gulp-strip-debug|`console.log`などの一括除去||
|gulp-uglify|ファイルのミニファイ処理（圧縮）|`production`モードのみ有効|

### images

画像ファイルを圧縮して出力します。

画像自体の圧縮と、メタ情報の削除を行います。設定によって圧縮率の変更も可能です。

### assets

`src/assets`配下にあるファイル・ディレクトリは、何も処理されずにそのまま`dist/`へコピーされます。

## スクリプト一覧

|コマンド|実行内容|補足|
|:---|:---|:---|
|`npm start`|ソースのコンパイル、編集の監視、開発サーバの起動|`Ctrl+C`で停止|
|`npm run build`|ソースのコンパイルのみを実行||
|`npm run clean`|コンパイルされたソースの一括削除||
|`npm run release`|納品用ビルド(production)の作成（macOS用）||
|`npm run winrelease`|納品用ビルド(production)の作成（Win用)||

## 更新履歴

|制作日|バージョン|内容|
|:---|:---|:---|
|2019/01/05|v4.1.0|オプション指定など追記|
|2019/01/05|v4.0.0|gulp4のリリースに合わせて書き直し|
|2018/09/30|v3.0.0|gulpfile.jsの書き直し
|2018/09/21|v2.0.0||
|2018/02/24|v1.1.0||
|2017/12/27|v1.0.0||